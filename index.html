<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTOL Sizer Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); }
        input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 font-sans selection:bg-blue-500/30">

    <div class="max-w-7xl mx-auto p-4 lg:p-10">
        <header class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-10 border-b border-slate-800 pb-6">
            <div>
                <h1 class="text-4xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300">
                    GEMINI VTOL SIZER
                </h1>
                <p class="text-slate-400 font-medium">Advanced Multi-Config Design & Simulation Suite</p>
            </div>
            <div class="flex items-center gap-3 bg-slate-900 p-2 rounded-lg border border-slate-800">
                <span class="text-xs font-bold text-slate-500 uppercase px-2">Solver Engine</span>
                <span class="bg-blue-500 text-xs px-2 py-1 rounded font-bold">V1.2 ITERATIVE</span>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <aside class="lg:col-span-4 space-y-6">
                <div class="glass p-6 rounded-2xl border border-slate-800 shadow-2xl">
                    <h3 class="text-lg font-bold mb-6 flex items-center gap-2">
                        <span class="w-2 h-6 bg-blue-500 rounded-full"></span> Mission Parameters
                    </h3>
                    
                    <div class="space-y-5">
                        <div class="group">
                            <label class="text-xs font-bold text-slate-500 uppercase tracking-widest">Configuration</label>
                            <select id="config" class="w-full bg-slate-900 mt-1 p-3 rounded-xl border border-slate-700 transition-all cursor-pointer">
                                <option value="quadplane">Quad-Plane (Discrete Propulsion)</option>
                                <option value="tiltrotor">Tilt-Rotor (Unified Thrust)</option>
                            </select>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-bold text-slate-500 uppercase tracking-widest">Payload (kg)</label>
                                <input type="number" id="m_pay" value="2.5" step="0.1" class="w-full bg-slate-900 mt-1 p-3 rounded-xl border border-slate-700">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500 uppercase tracking-widest">Air Speed (m/s)</label>
                                <input type="number" id="v_cr" value="28" class="w-full bg-slate-900 mt-1 p-3 rounded-xl border border-slate-700">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-bold text-slate-500 uppercase tracking-widest">Endurance (hr)</label>
                                <input type="number" id="t_end" value="1.5" step="0.1" class="w-full bg-slate-900 mt-1 p-3 rounded-xl border border-slate-700">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500 uppercase tracking-widest">Headwind (m/s)</label>
                                <input type="number" id="v_wind" value="5" class="w-full bg-slate-900 mt-1 p-3 rounded-xl border border-slate-700">
                            </div>
                        </div>

                        <div>
                            <label class="text-xs font-bold text-slate-500 uppercase tracking-widest">Operating Alt (m)</label>
                            <input type="number" id="alt" value="500" class="w-full bg-slate-900 mt-1 p-3 rounded-xl border border-slate-700">
                        </div>

                        <button onclick="calculate()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-4 rounded-xl shadow-lg shadow-blue-900/20 transition-all transform active:scale-95 uppercase tracking-tighter">
                            Compute Design Matrix
                        </button>
                    </div>
                </div>
            </aside>

            <main class="lg:col-span-8 space-y-6">
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="glass border border-slate-800 p-5 rounded-2xl">
                        <p class="text-[10px] font-bold text-slate-500 uppercase mb-1">Total MTOW</p>
                        <p id="res_mtow" class="text-2xl font-black text-blue-400">--</p>
                    </div>
                    <div class="glass border border-slate-800 p-5 rounded-2xl">
                        <p class="text-[10px] font-bold text-slate-500 uppercase mb-1">Mission Range</p>
                        <p id="res_range" class="text-2xl font-black text-cyan-400">--</p>
                    </div>
                    <div class="glass border border-slate-800 p-5 rounded-2xl">
                        <p class="text-[10px] font-bold text-slate-500 uppercase mb-1">Battery Size</p>
                        <p id="res_batt" class="text-2xl font-black text-emerald-400">--</p>
                    </div>
                    <div class="glass border border-slate-800 p-5 rounded-2xl">
                        <p class="text-[10px] font-bold text-slate-500 uppercase mb-1">Wing Loading</p>
                        <p id="res_ws" class="text-2xl font-black text-amber-400">--</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass border border-slate-800 p-6 rounded-2xl h-80 flex flex-col items-center">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-4 self-start">Mass Distribution Breakdown</h4>
                        <div class="relative w-full h-full">
                            <canvas id="massChart"></canvas>
                        </div>
                    </div>
                    <div class="glass border border-slate-800 p-6 rounded-2xl overflow-y-auto">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-4">Engineering Alerts & Constraints</h4>
                        <div id="alerts" class="space-y-3">
                            <p class="text-slate-500 italic text-sm">Run solver to generate report...</p>
                        </div>
                    </div>
                </div>

                <div class="glass border border-slate-800 rounded-2xl overflow-hidden">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-slate-900/50 text-slate-500 uppercase text-[10px] font-bold">
                            <tr>
                                <th class="px-6 py-4">Structural Parameter</th>
                                <th class="px-6 py-4 text-right">Calculated Value</th>
                                <th class="px-6 py-4">Design Constraint</th>
                            </tr>
                        </thead>
                        <tbody id="table_body" class="divide-y divide-slate-800">
                            </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <script>
        let massChart;

        function calculate() {
            // Inputs
            const config = document.getElementById('config').value;
            const m_pay = parseFloat(document.getElementById('m_pay').value);
            const v_cr = parseFloat(document.getElementById('v_cr').value);
            const v_wind = parseFloat(document.getElementById('v_wind').value);
            const t_end = parseFloat(document.getElementById('t_end').value);
            const alt = parseFloat(document.getElementById('alt').value);

            // 1. Environment: Density Altitude
            const rho_0 = 1.225;
            const rho = rho_0 * Math.pow((1 - (0.0065 * alt) / 288.15), 5.255);

            // 2. Constants by Config
            const cd0 = config === 'quadplane' ? 0.048 : 0.032;
            const s_frac = config === 'quadplane' ? 0.28 : 0.36; 
            const prop_eff = 0.75;
            const batt_energy_density = 250; // Wh/kg (High-density Li-ion)

            // 3. The Iterative Solver (Converging MTOW)
            let mtow = m_pay / 0.2; // Start guess
            let m_batt, s_wing, p_cr, p_h;

            for (let i = 0; i < 100; i++) {
                // Sizing for Cruise
                s_wing = (mtow * 9.81) / (0.5 * rho * Math.pow(v_cr, 2) * 0.65); // Cl_cr = 0.65
                p_cr = (0.5 * rho * Math.pow(v_cr, 3) * s_wing * cd0 + (2 * Math.pow(mtow * 9.81, 2)) / (rho * v_cr * s_wing * Math.PI * 10)) / prop_eff;
                
                // Sizing for Hover (Estimated total disk area for typical 10-15kg UAV)
                const disk_area = 1.2; 
                p_h = Math.sqrt(Math.pow(mtow * 9.81, 3) / (2 * rho * disk_area)) / 0.65;

                let energy_wh = (p_cr * t_end) + (p_h * 0.083); // Cruise + 5 mins hover/trans
                m_batt = energy_wh / (batt_energy_density * 0.85); // 85% depth of discharge
                
                let m_struc = mtow * s_frac;
                let m_prop = mtow * (config === 'quadplane' ? 0.18 : 0.12);
                let current_sum = m_pay + m_batt + m_struc + m_prop + 0.5; // +500g avionics

                if (Math.abs(current_sum - mtow) < 0.01) break;
                mtow = current_sum;
            }

            // 4. Ground Speed & Range
            const v_ground = v_cr - v_wind;
            const range_km = (v_ground * t_end * 3600) / 1000;

            // Update UI
            document.getElementById('res_mtow').innerText = mtow.toFixed(2) + " kg";
            document.getElementById('res_range').innerText = Math.max(0, range_km).toFixed(1) + " km";
            document.getElementById('res_batt').innerText = m_batt.toFixed(2) + " kg";
            document.getElementById('res_ws').innerText = ( (mtow * 9.81) / s_wing ).toFixed(1) + " N/m²";

            updateTable(mtow, s_wing, p_h, p_cr);
            updateAlerts(v_ground, mtow, s_wing);
            renderChart(m_pay, m_batt, mtow * s_frac, (mtow - m_pay - m_batt - (mtow * s_frac)));
        }

        function updateTable(mtow, s_wing, ph, pcr) {
            const tbody = document.getElementById('table_body');
            const data = [
                ["Wing Area", s_wing.toFixed(3) + " m²", "Target Cl=0.65"],
                ["Hover Power Draw", (ph/1000).toFixed(2) + " kW", "Max Battery Discharge"],
                ["Cruise Power Draw", (pcr/1000).toFixed(2) + " kW", "High Efficiency Range"],
                ["Disk Loading", ( (mtow*9.81) / 1.2 ).toFixed(1) + " N/m²", "Standard VTOL Efficiency"]
            ];
            tbody.innerHTML = data.map(row => `<tr><td class="px-6 py-4 font-medium text-slate-300">${row[0]}</td><td class="px-6 py-4 text-right font-mono text-blue-400">${row[1]}</td><td class="px-6 py-4 text-xs text-slate-500 italic">${row[2]}</td></tr>`).join('');
        }

        function updateAlerts(vg, mtow, sw) {
            const container = document.getElementById('alerts');
            container.innerHTML = "";
            const ws = (mtow * 9.81) / sw;

            if (vg < 10) container.innerHTML += `<div class="p-3 bg-red-500/10 text-red-400 text-xs border border-red-500/20 rounded-lg"><strong>CRITICAL:</strong> Ground speed insufficient for headwind.</div>`;
            if (ws > 100) container.innerHTML += `<div class="p-3 bg-amber-500/10 text-amber-400 text-xs border border-amber-500/20 rounded-lg"><strong>STALL RISK:</strong> Wing loading too high for safe transition.</div>`;
            if (mtow > 25) container.innerHTML += `<div class="p-3 bg-blue-500/10 text-blue-400 text-xs border border-blue-500/20 rounded-lg"><strong>NOTE:</strong> Weight class requires Category C aviation compliance.</div>`;
            if (container.innerHTML === "") container.innerHTML = `<p class="text-emerald-400 text-sm">✅ All design parameters within safe corridor.</p>`;
        }

        function renderChart(pay, batt, struc, other) {
            const ctx = document.getElementById('massChart');
            if (massChart) massChart.destroy();
            massChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Payload', 'Energy', 'Structure', 'Avionics'],
                    datasets: [{
                        data: [pay, batt, struc, other],
                        backgroundColor: ['#60a5fa', '#34d399', '#a78bfa', '#475569'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    cutout: '70%',
                    plugins: { legend: { display: false } },
                    maintainAspectRatio: false
                }
            });
        }

        window.onload = calculate;
    </script>
</body>

</html>
